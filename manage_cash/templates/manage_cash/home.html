{% extends "manage_cash/base.html" %}
{% load static %}

{% block title %}Главная — Учёт ДДС{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-4">Движение денежных средств</h1>

  <!-- Статистика -->
  <div class="alert alert-info">
    Всего записей: <strong>{{ total_transaction }}</strong>
  </div>

   <!--Сортировка
   <div class="mb-3">
      <strong>Сортировать по:</strong>
      <a href="?status" class="btn btn-sm btn-outline-primary">Статусу</a>
      <a href="?type" class="btn btn-sm btn-outline-primary">Типу</a>
      <a href="?category" class="btn btn-sm btn-outline-primary">Категории</a>
      <a href="?subcategory" class="btn btn-sm btn-outline-primary">Подкатегории</a>
      <a href="?date" class="btn btn-sm btn-outline-primary">Дате ↑</a>
      <a href="?-date" class="btn btn-sm btn-outline-primary">Дате ↓</a>
    </div>-->
  <!-- Форма фильтрации -->
  <form method="get" class="mb-4 p-3 border rounded bg-light">
    <div class="row g-2">
      <!-- Дата от / до -->
      <div class="col-md-2">
        <label class="form-label">Дата от</label>
        <input type="date" name="start_date" class="form-control" value="{{ request.GET.start_date }}">
      </div>
      <div class="col-md-2">
        <label class="form-label">Дата до</label>
        <input type="date" name="end_date" class="form-control" value="{{ request.GET.end_date }}">
      </div>

      <!-- Статус -->
      <div class="col-md-2">
        <label class="form-label">Статус</label>
        <select name="status" class="form-select">
          <option value="">Все</option>
          {% for s in statuses %}
            <option value="{{ s.id }}" {% if s.id|stringformat:"s" == request.GET.status %}selected{% endif %}>
              {{ s.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Тип -->
      <div class="col-md-2">
        <label class="form-label">Тип</label>
        <select name="type" class="form-select">
          <option value="">Все</option>
          {% for t in types %}
            <option value="{{ t.id }}" {% if t.id|stringformat:"s" == request.GET.type %}selected{% endif %}>
              {{ t.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Категория -->
      <div class="col-md-2">
        <label class="form-label">Категория</label>
        <select name="category" class="form-select">
          <option value="">Все</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {% if c.id|stringformat:"s" == request.GET.category %}selected{% endif %}>
              {{ c.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Подкатегория -->
      <div class="col-md-2">
        <label class="form-label">Подкатегория</label>
        <select name="subcategory" class="form-select">
          <option value="">Все</option>
          {% for sc in subcategories %}
            <option value="{{ sc.id }}" {% if sc.id|stringformat:"s" == request.GET.subcategory %}selected{% endif %}>
              {{ sc.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Кнопки -->
      <div class="col-12 mt-2">
        <button type="submit" class="btn btn-primary">Применить</button>
        <a href="{% url 'manage_cash:home' %}" class="btn btn-secondary">Сбросить</a>
      </div>
    </div>
  </form>
  <!-- Таблица транзакций -->
  {% if transactions %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Дата</th>
            <th>Статус</th>
            <th>Тип</th>
            <th>Категория</th>
            <th>Подкатегория</th>
            <th>Сумма</th>
            <th>Комментарий</th>
          </tr>
        </thead>

        <tbody>
          {% for t in transactions %}
            <tr>
              <td>{{ t.date }}</td>
              <td>{{ t.status.name }}</td>
              <td>{{ t.type.name }}</td>
              <td>{{ t.category.name }}</td>
              <td>{{ t.subcategory.name }}</td>
              <td>{{ t.amount }} ₽</td>
              <td>{{ t.comment|default:"—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-center text-muted mt-5">
      <p>Нет записей</p>
    </div>
  {% endif %}
</div>
{% endblock %}